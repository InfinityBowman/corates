# Claude Code Instructions for CoRATES

This project is **CoRATES** (Collaborative Research Appraisal Tool for Evidence Synthesis), a SolidJS-based web application deployed on Cloudflare Workers.

## Coding Standards

- **No emojis** in code, comments, documentation, or commit messages
- For UI icons, use the `solid-icons` library or SVGs only (never emojis)
- Follow standard JavaScript/SolidJS/Cloudflare best practices
- Prefer modern ES6+ syntax and features
- Use aliases for imports when appropriate to improve readability
- Use responsive design principles for UI components
- Prefer using config files rather than hardcoding values

## File Size Guidelines

- **Keep files small, focused, and modular** - aim for ~200-300 lines max per component file
- If a component exceeds ~300 lines, consider refactoring:
  - Extract sub-components into a folder (e.g., `ComponentName/` with `index.jsx` and helper components)
  - Move complex logic into separate utility files or primitives
  - Split large forms into section components (see `add-studies/` folder pattern)
- Each file should handle one coherent responsibility
- Group related components in subdirectories with an `index.js` barrel export

## Project Structure

- This project is split into multiple packages under the `packages/` directory:
  - `packages/landing` - Landing/marketing site
  - `packages/web` - Main application
  - `packages/workers` - Backend services
  - `packages/mcp` - MCP server for tooling
- Each package may have its own dependencies and configurations
- Cloudflare Pages is NOT used; only Cloudflare Workers is used for backend services and frontend deployments

## MCP Tools Available

Use these MCP tools when appropriate:

- `search_icons` - Search through solid-icons library by keyword (e.g., "arrow", "check", "user")
- `run_lint` - Run pnpm lint from the repository root (set fix=true to apply autofixes)
- `docs_list` - List local documentation sources in `docs/` folder
- `docs_get_llms_txt` - Get contents of `docs/<doc>/llms.txt`

## Zag.js UI Components

When implementing UI components, use Zag.js. Reference documentation in `docs/zag/llms.txt`.

### Existing Zag Components

The following Zag components exist in `packages/web/src/components/zag/` and should be reused:

- `Avatar.jsx` - User avatar with image and fallback initials
- `Checkbox.jsx` - Checkbox input with label
- `Collapsible.jsx` - Expandable/collapsible content sections
- `Dialog.jsx` - Modal dialogs
- `FileUpload.jsx` - File upload with drag-and-drop
- `FloatingPanel.jsx` - Draggable and resizable floating panel
- `PasswordInput.jsx` - Password input with show/hide toggle
- `Splitter.jsx` - Resizable split panes
- `Switch.jsx` - Toggle switch
- `Tabs.jsx` - Tabbed content
- `Toast.jsx` - Toast notifications (use via `useToast` from `@primitives/useToast.jsx`)
- `Tooltip.jsx` - Tooltips with arrow support

Always check for existing Zag components before creating new ones or using plain HTML inputs.

## Database Migrations

- All migrations should go in a single file: `packages/workers/migrations/0001_init.sql`
- Do NOT create separate migration files (e.g., 0002_xxx.sql) since this project is not yet in production
- When adding new tables or schema changes, edit the existing 0001_init.sql file directly

## SolidJS State Architecture (Very Important)

To keep the codebase maintainable and avoid prop drilling:

- **Do NOT prop-drill application state**
- Shared or cross-feature state must live in external stores under `packages/web/src/stores/` or relative to the component file
- Import stores directly where needed instead of passing values through multiple components
- Components should receive at most 1–5 props, and only for local configuration, not shared state
- If a component would need more than 5 props, move the shared data into:
  - An external store
  - A primitive
  - Or Solid context (when scoped to a feature)
- ALWAYS prefer the CLEANEST solution

### Destructuring Props

With Solid, destructuring props breaks reactivity. Instead:

```js
function MyComponent(props) {
  const { name } = props; // ❌ breaks reactivity
  const name = props.name; // ❌ breaks reactivity
  const name = () => props.name; // ✓ wrapping maintains reactivity

  // or
  return <div>{props.name}</div>; // ✓ direct access maintains reactivity
}
```

### Using createMemo and createStore

- Use `createMemo` for derived values to ensure reactive updates
- Use `createStore` for complex state or state objects for better performance and reactivity
- Stores are great, use them!

### Primitives

Create reusable logic in "primitives" (hooks) that can be shared across components. This keeps components clean and focused on rendering.

## Component Guidelines

- Components should be lean and focused
- They should NOT implement business logic; move that into:
  - Stores
  - Utilities
  - Primitives
- Never have a component act as a "God component" coordinating multiple large concerns

## Additional References

- `architecture-goals.md` - Architecture and design patterns
- `style-guide.md` - Style and formatting guidelines
- `TESTING.md` - Testing guidelines (do NOT add tests unless asked)
- See `vite.config.js` or `jsconfig.json` for path aliases and build configurations
